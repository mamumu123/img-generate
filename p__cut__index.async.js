"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[909],{977:function(he,$,e){e.r($),e.d($,{default:function(){return we}});var Y=e(15009),H=e.n(Y),J=e(99289),R=e.n(J),Z=e(5574),i=e.n(Z),k=e(90930),P=e(71230),O=e(15746),N=e(4393),U=e(63232),E=e(97029),_=e(5298),I=e(72269),y=e(84385),r=e(62435),p={container:"container___ah07h",row__container:"row__container___DE0zL",block__container:"block__container___oaINu",mask__canvas:"mask__canvas___r41sD",crop__container:"crop__container___tJzsk",card__box:"card__box___KYHnQ",checkbox__container:"checkbox__container___S9S_k",btn__op:"btn__op___m8nwt"},x=e(9632),ee=e(19515),g=e(26420),te=e(64868),Q="/water.png",d={toRed:"toRed",toGreen:"toGreen",toBlue:"toBlue",flipUpsideDown:"flipUpsideDown",flipSideToSide:"flipSideToSide",leftRotate:"leftRotate",rightRotate:"rightRotate",toGrey:"toGrey",toBlackAndWhite:"toBlackAndWhite",sharpen:"sharpen",marginSharpen:"marginSharpen",toGaussianBlur:"toGaussianBlur",reset:"reset"},F={toRed:g.NK,toGreen:g.a_,toBlue:g.$R,flipUpsideDown:g.x9,flipSideToSide:g.EG,toGrey:g.FZ,toBlackAndWhite:g.Sn,sharpen:g.dF,marginSharpen:g.Ec,toGaussianBlur:g.Uc},se=[{key:d.toRed,label:"\u7EA2\u8272\u6EE4\u955C"},{key:d.toGreen,label:"\u7EFF\u8272\u6EE4\u955C"},{key:d.toBlue,label:"\u84DD\u8272\u6EE4\u955C"},{key:d.marginSharpen,label:"\u8FB9\u7F18\u9510\u5316"},{key:d.sharpen,label:"\u9510\u5316"},{key:d.toBlackAndWhite,label:"\u9ED1\u767D\u5316"},{key:d.toGrey,label:"\u7070\u5316"},{key:d.flipSideToSide,label:"\u5DE6\u53F3\u7FFB\u8F6C"},{key:d.flipUpsideDown,label:"\u4E0A\u4E0B\u7FFB\u8F6C"}],t=e(86074),X=function(M){var W=M.options;return(0,t.jsx)(P.Z,{children:W.map(function(c){return(0,t.jsx)(U.Z,{value:c.key,children:c.label},c.key)})})},ie=e(27320);function Ze(V){return new Promise(function(M,W){var c=new Image;c.onload=function(){M({width:c.width,height:c.height})},c.onerror=function(q){console.error("error",q),W(new Error("Failed to load image"))},c.crossOrigin="anonymous",c.src=V})}var ke=e(97857),fe=e.n(ke),Oe=e(19632),Ue=e.n(Oe),Ie=e(88484),Le=e(72708),Ae=function(M){var W=M.url,c=M.setUrl,q=function(f){c==null||c(f.target.value||Q)},ae=(0,r.useState)([]),j=i()(ae,2),L=j[0],A=j[1],le={onRemove:function(f){var K=L.indexOf(f),w=L.slice();w.splice(K,1),A(w)},beforeUpload:function(f){return A([].concat(Ue()(L),[f])),!1},fileList:L};return(0,r.useEffect)(function(){var B=L[0];if(B){var f=new FileReader;f.onload=function(K){var w;c((w=K.target)===null||w===void 0?void 0:w.result)},f.readAsDataURL(B)}},[L]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{style:{display:"flex"},children:[(0,t.jsx)(Le.Z,fe()(fe()({},le),{},{children:(0,t.jsx)(E.ZP,{icon:(0,t.jsx)(Ie.Z,{}),children:"\u4E0A\u4F20\u56FE\u7247"})})),(0,t.jsx)(y.Z,{value:W||Q,onChange:q,allowClear:!0})]})})};function Be(){var V=(0,r.useState)([]),M=i()(V,2),W=M[0],c=M[1],q=(0,x.Z)("url",{defaultValue:Q}),ae=i()(q,2),j=ae[0],L=ae[1],A=(0,r.useRef)(null),le=(0,r.useState)(),B=i()(le,2),f=B[0],K=B[1],w=(0,r.useState)(),ge=i()(w,2),o=ge[0],Te=ge[1],ue=(0,r.useRef)(null),Ge=(0,r.useState)(0),me=i()(Ge,2),v=me[0],de=me[1],Ne=(0,r.useState)(0),_e=i()(Ne,2),h=_e[0],ce=_e[1],Fe=(0,r.useState)(0),xe=i()(Fe,2),C=xe[0],ne=xe[1],We=(0,r.useState)(0),Ce=i()(We,2),S=Ce[0],re=Ce[1],Ke=(0,r.useState)({x:0,y:0}),Se=i()(Ke,2),ye=Se[0],pe=Se[1],ze=(0,x.Z)("startCrop",{defaultValue:!1}),be=i()(ze,2),T=be[0],$e=be[1];(0,r.useEffect)(function(){var n=ue.current,a=n==null?void 0:n.getContext("2d");if(!(!a||!o)&&(a.clearRect(0,0,o==null?void 0:o.width,o==null?void 0:o.height),T)){a.fillStyle="rgba(125, 125, 125, 0.5)",a.fillRect(0,0,o==null?void 0:o.width,o==null?void 0:o.height),a.clearRect(v,h,C,S);var s=10,u=[{x:v+C/2,y:h},{x:v+C,y:h+S/2},{x:v+C/2,y:h+S},{x:v,y:h+S/2}];u.forEach(function(l){a.beginPath(),a.arc(l.x,l.y,s,0,2*Math.PI),a.lineWidth=5,a.strokeStyle="red",a.stroke()})}},[T,v,h,C,S,o]),(0,r.useEffect)(function(){j&&Ze(j).then(function(){var n=R()(H()().mark(function a(s){var u,l,D,m,b,G,oe;return H()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return u=s.width,l=s.height,z.next=3,(0,ee.po)(j);case 3:if(D=z.sent,m=document.createElement("canvas"),b=m.getContext("2d"),m.width=u,m.height=l,b){z.next=10;break}return z.abrupt("return");case 10:b.drawImage(D,0,0,u,l),G=b.getImageData(0,0,u,l),Te(G),K(G),ne(u),re(l),oe=ue.current,oe&&(oe.width=u,oe.height=l);case 18:case"end":return z.stop()}},a)}));return function(a){return n.apply(this,arguments)}}()).catch(function(n){console.error(n)})},[j]),(0,r.useEffect)(function(){var n=A.current;if(!(!n||!j)){var a=n.getContext("2d");a&&f&&(n.width=f.width,n.height=f.height,a.putImageData(f,0,0))}},[f]);var He=function(a){if(c(a),console.log("checked = ",a),!(!j||!o)){var s=o,u=a.reduce(function(l,D){var m,b=D;return s=((m=F[b])===null||m===void 0?void 0:m.call(F,l))||s,s},s);K(u)}},ve=function(a){if(!(!j||!f)){var s=f;a===d.leftRotate&&(s=(0,g.zu)(s)||s),a===d.rightRotate&&(s=(0,g.ER)(s)||s),a===d.reset&&(s=o,c([])),K(s)}},Ye=(0,r.useState)(!1),je=i()(Ye,2),Je=je[0],Ee=je[1],Qe=(0,r.useState)(!1),De=i()(Qe,2),Xe=De[0],Re=De[1],Ve=(0,r.useState)(-1),Pe=i()(Ve,2),qe=Pe[0],Me=Pe[1],et=function(a){var s=(0,ie.y)(A.current,a),u=s.x,l=s.y;u>=v&&u<=v+C&&l>=h&&l<=h+S&&(Ee(!0),pe({x:u-v,y:l-h}));var D=10,m=[{x:v+C/2,y:h},{x:v+C,y:h+S/2},{x:v+C/2,y:h+S},{x:v,y:h+S/2}];m.forEach(function(b,G){(0,ie.j)(u,l,b.x,b.y,D)&&(Re(!0),Me(G),pe({x:u-v,y:l-h}))})},tt=function(){Ee(!1),Re(!1),Me(-1)},at=function(a){if(o&&Je){var s=(0,ie.y)(A.current,a),u=s.x,l=s.y,D=u-ye.x,m=l-ye.y;if(D>=0&&D+C<=(o==null?void 0:o.width)&&de(D),m>=0&&m+S<=(o==null?void 0:o.height)&&ce(m),Xe){var b=u-v,G=l-h;switch(qe){case 0:ce(l),re(S-G);break;case 1:ne(b);break;case 2:re(G);break;case 3:de(u),ne(C-b);break;default:break}}}};return(0,t.jsx)(k._z,{children:(0,t.jsx)("div",{className:p.container,children:(0,t.jsxs)(P.Z,{className:p.row__container,children:[(0,t.jsx)(O.Z,{span:24,children:(0,t.jsxs)(N.Z,{children:[(0,t.jsx)(Ae,{setUrl:L,url:j||""}),(0,t.jsx)(U.Z.Group,{style:{width:"100%"},onChange:He,value:W,className:p.checkbox__container,children:(0,t.jsx)(X,{options:se})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(E.ZP,{onClick:function(){return ve(d.leftRotate)},className:p.btn__op,children:"\u5411\u5DE6\u65CB\u8F6C"}),(0,t.jsx)(E.ZP,{onClick:function(){return ve(d.rightRotate)},className:p.btn__op,children:"\u5411\u53F3\u65CB\u8F6C"}),(0,t.jsx)(E.ZP,{onClick:function(){return ve(d.reset)},danger:!0,children:"\u6E05\u7A7A\u6548\u679C"})]})]})}),(0,t.jsxs)(O.Z,{span:20,className:p.block__container,children:[(0,t.jsx)("canvas",{ref:A}),(0,t.jsx)("canvas",{ref:ue,className:p.mask__canvas,onMouseDown:et,onMouseUp:tt,onMouseMove:at})]}),(0,t.jsx)(O.Z,{span:4,className:p.crop__container,children:(0,t.jsxs)(N.Z,{className:p.card__box,children:[(0,t.jsx)(_.Z.Item,{label:"\u5F00\u542F\u88C1\u526A",children:(0,t.jsx)(I.Z,{checked:T,onChange:function(a){return $e(a)}})}),(0,t.jsx)(_.Z.Item,{label:"X",children:(0,t.jsx)(y.Z,{type:"number",value:v,disabled:!T,onChange:function(a){return de(Number(a.target.value))}})}),(0,t.jsx)(_.Z.Item,{label:"Y",children:(0,t.jsx)(y.Z,{type:"number",value:h,disabled:!T,onChange:function(a){return ce(Number(a.target.value))}})}),(0,t.jsx)(_.Z.Item,{label:"\u5BBD",children:(0,t.jsx)(y.Z,{type:"number",value:C,disabled:!T,onChange:function(a){return ne(Number(a.target.value))}})}),(0,t.jsx)(_.Z.Item,{label:"\u9AD8",children:(0,t.jsx)(y.Z,{type:"number",value:S,disabled:!T,onChange:function(a){return re(Number(a.target.value))}})}),(0,t.jsx)(E.ZP,{onClick:function(){return(0,te.n)(A.current,T?[v,h,C,S]:[])},children:"\u4E0B\u8F7D"})]})})]})})})}var we=Be},27320:function(he,$,e){e.d($,{j:function(){return H},y:function(){return Y}});var Y=function(R,Z){if(!R)return{x:0,y:0};var i=R.getBoundingClientRect(),k=Z.clientX-i.left,P=Z.clientY-i.top;return{x:k,y:P}},H=function(R,Z,i,k,P){var O=R-i,N=Z-k;return O*O+N*N<=P*P}},64868:function(he,$,e){e.d($,{L:function(){return O},n:function(){return N}});var Y=e(5574),H=e.n(Y),J=e(15009),R=e.n(J),Z=e(99289),i=e.n(Z),k=e(78356),P=e(19515),O=function(){var U=i()(R()().mark(function E(_){var I,y,r;return R()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(0,P.e3)()){x.next=4;break}k.ZP.info({content:"\u7531\u4E8E\u5FAE\u4FE1\u6D4F\u89C8\u5668\u7684\u9650\u5236\uFF0C\u65E0\u6CD5\u4E0B\u8F7D\u56FE\u7247\uFF0C\u8BF7\u3010\u957F\u6441\u5934\u50CF\u4FDD\u5B58\u4E3A\u56FE\u7247\u3011\u6216\u8005\u53F3\u4E0A\u89D2\u7528\u7CFB\u7EDF\u6D4F\u89C8\u5668\u6253\u5F00\u4F7F\u7528\uFF0C\u8C22\u8C22\u3002"}),x.next=13;break;case 4:if(I=_.current,y=document.createElement("a"),I){x.next=9;break}return k.ZP.error("\u9047\u5230\u4E00\u4E9B\u95EE\u9898\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),x.abrupt("return");case 9:y.href=I.toDataURL(),y.download="\u6587\u4EF6\u540D\u79F0",r=new MouseEvent("click"),y.dispatchEvent(r);case 13:case"end":return x.stop()}},E)}));return function(_){return U.apply(this,arguments)}}();function N(U,E){var _=H()(E,4),I=_[0],y=I===void 0?0:I,r=_[1],p=r===void 0?0:r,x=_[2],ee=x===void 0?U.width:x,g=_[3],te=g===void 0?U.height:g,Q=U.getContext("2d"),d=Q.getImageData(y,p,ee,te),F=document.createElement("canvas");F.width=ee,F.height=te;var se=F.getContext("2d");se.putImageData(d,0,0),console.log("tempCtx",d),F.toBlob(function(t){var X=document.createElement("a");X.download="canvas.png",X.href=URL.createObjectURL(t),X.click()},"image/png")}}}]);
